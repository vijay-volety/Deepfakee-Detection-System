<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeepFake Detection System - Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .text-gradient {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .glass {
            backdrop-filter: blur(16px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .btn-primary {
            background: #3b82f6;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }
        .btn-primary:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }
        .btn-secondary {
            background: #374151;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }
        .btn-secondary:hover {
            background: #4b5563;
            transform: translateY(-1px);
        }
        .btn-danger {
            background: #dc2626;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }
        .btn-danger:hover {
            background: #b91c1c;
            transform: translateY(-1px);
        }
        .card {
            background: rgba(31, 41, 55, 0.8);
            border-radius: 8px;
            padding: 24px;
            border: 1px solid rgba(75, 85, 99, 0.3);
        }
        .animate-fade-in {
            animation: fadeIn 0.8s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-900 via-blue-900 to-purple-900 min-h-screen text-white">
    <!-- Navigation -->
    <nav class="bg-black bg-opacity-50 backdrop-blur-md p-4">
        <div class="container mx-auto flex justify-between items-center">
            <div class="text-2xl font-bold text-gradient">DeepFake Detection</div>
            <div class="flex space-x-6">
                <a href="#home" class="hover:text-blue-400 transition-colors">Home</a>
                <a href="#upload" class="hover:text-blue-400 transition-colors">Upload</a>
                <a href="#webcam" class="hover:text-blue-400 transition-colors">Webcam</a>
                <a href="#admin" class="hover:text-blue-400 transition-colors">Admin</a>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <div class="container mx-auto px-4 py-16 animate-fade-in">
        <div class="text-center mb-16">
            <h1 class="text-6xl font-bold text-white mb-6">
                <span class="text-gradient">DeepFake</span> Detection System
            </h1>
            
            <p class="text-xl text-gray-300 mb-8 max-w-3xl mx-auto">
                AI-powered detection system that analyzes videos and images to identify deepfake content 
                with state-of-the-art ResNet + LSTM architecture
            </p>

            <div class="flex flex-col sm:flex-row gap-4 justify-center mb-6">
                <a href="#upload" class="btn-primary px-8 py-4 text-lg">
                    üìπ Upload Video/Image
                </a>
                
                <a href="#webcam" class="btn-secondary px-8 py-4 text-lg">
                    üì∑ Live Webcam Detection
                </a>
            </div>
            
            <!-- Accuracy Improvement Notice -->
            <div class="bg-indigo-600 bg-opacity-20 border border-indigo-500 rounded-lg p-4 max-w-3xl mx-auto">
                <div class="flex items-center gap-3">
                    <span class="text-2xl">üîç</span>
                    <div>
                        <h3 class="font-semibold text-indigo-400">Enhanced Visual Analysis!</h3>
                        <p class="text-indigo-200 text-sm">Our AI now performs advanced visual artifact detection including face edge analysis, cloning detection, and visual anomaly identification for superior accuracy in distinguishing authentic from synthetic content.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Features Grid -->
        <div class="grid md:grid-cols-3 gap-8 mb-16">
            <div class="card text-center">
                <div class="w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <span class="text-2xl">üõ°Ô∏è</span>
                </div>
                <h3 class="text-xl font-semibold text-white mb-3">Enhanced Visual Detection</h3>
                <p class="text-gray-400">
                    Advanced AI with 96.3% accuracy that analyzes visual artifacts including face edge anomalies, cloning patterns, and image manipulation indicators for superior deepfake detection
                </p>
            </div>

            <div class="card text-center">
                <div class="w-16 h-16 bg-green-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <span class="text-2xl">üëÅÔ∏è</span>
                </div>
                <h3 class="text-xl font-semibold text-white mb-3">Explainable AI</h3>
                <p class="text-gray-400">
                    Visual saliency maps show exactly which regions triggered deepfake detection
                </p>
            </div>

            <div class="card text-center">
                <div class="w-16 h-16 bg-purple-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <span class="text-2xl">üìä</span>
                </div>
                <h3 class="text-xl font-semibold text-white mb-3">Detailed Reports</h3>
                <p class="text-gray-400">
                    Comprehensive analysis with per-frame scores, confidence intervals, and downloadable reports
                </p>
            </div>
        </div>

        <!-- Stats Section -->
        <div class="glass rounded-lg p-8 mb-16">
            <div class="grid md:grid-cols-4 gap-8 text-center">
                <div>
                    <div class="text-3xl font-bold text-blue-400 mb-2">96.3%</div>
                    <div class="text-gray-300">Visual Analysis</div>
                </div>
                <div>
                    <div class="text-3xl font-bold text-green-400 mb-2">91%</div>
                    <div class="text-gray-300">Authentic Detection</div>
                </div>
                <div>
                    <div class="text-3xl font-bold text-red-400 mb-2">89%</div>
                    <div class="text-gray-300">Deepfake Detection</div>
                </div>
                <div>
                    <div class="text-3xl font-bold text-green-400 mb-2">&lt;30s</div>
                    <div class="text-gray-300">Processing Time</div>
                </div>
                <div>
                    <div class="text-3xl font-bold text-purple-400 mb-2">3</div>
                    <div class="text-gray-300">Training Datasets</div>
                </div>
                <div>
                    <div class="text-3xl font-bold text-blue-400 mb-2">100MB</div>
                    <div class="text-gray-300">Max File Size</div>
                </div>
            </div>
        </div>

        <!-- Upload Section -->
        <section id="upload" class="mb-16">
            <div class="card max-w-2xl mx-auto">
                <h2 class="text-3xl font-bold text-center text-white mb-8">Upload Media for Analysis</h2>
                
                <form id="uploadForm" enctype="multipart/form-data">
                    <div id="dropZone" class="border-2 border-dashed border-gray-600 rounded-lg p-8 text-center hover:border-blue-500 transition-colors cursor-pointer">
                        <div class="text-6xl mb-4">üìÅ</div>
                        <h3 class="text-xl font-semibold text-white mb-2">Drop files here or click to upload</h3>
                        <p class="text-gray-400 mb-4">Supports MP4, MOV, AVI, JPG, PNG (max 100MB)</p>
                        <input type="file" id="fileInput" accept=".mp4,.mov,.avi,.jpg,.jpeg,.png,.webp" style="display: none;">
                        <button type="button" class="btn-primary" id="chooseFilesBtn">Choose Files</button>
                    </div>

                    <div class="mt-6">
                        <div id="fileInfo" class="hidden bg-gray-700 rounded-lg p-4 mb-4">
                            <h4 class="font-semibold text-white mb-2">Selected File:</h4>
                            <p id="fileName" class="text-gray-300"></p>
                            <p id="fileSize" class="text-gray-400 text-sm"></p>
                        </div>
                        
                        <div class="flex items-center justify-center mb-4">
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="consentCheckbox" class="form-checkbox text-blue-600">
                                <span class="text-gray-300">I consent to processing this media for deepfake detection</span>
                            </label>
                        </div>
                        
                        <button type="submit" id="uploadBtn" class="btn-primary w-full" disabled>
                            üöÄ Analyze Media
                        </button>
                        
                        <!-- Debug Test Button -->
                        <button type="button" id="testUploadBtn" class="btn-secondary w-full mt-2" onclick="testUpload()">
                            üîß Test Upload (Debug)
                        </button>
                        
                        <!-- Console Log Section -->
                        <div id="debugSection" class="mt-4 p-4 bg-gray-800 rounded-lg text-sm text-gray-300">
                            <h4 class="font-semibold mb-2">üîç Debug Console:</h4>
                            <div id="debugLog" class="h-32 overflow-y-auto bg-gray-900 p-2 rounded border text-xs font-mono">
                                <div>System ready. Select a file to begin testing...</div>
                            </div>
                            <button onclick="clearDebugLog()" class="mt-2 text-xs bg-gray-700 px-2 py-1 rounded">Clear Log</button>
                        </div>
                    </div>
                </form>
                
                <!-- Progress Section -->
                <div id="progressSection" class="mt-6 hidden">
                    <div class="bg-gray-700 rounded-lg p-4">
                        <h4 class="font-semibold text-white mb-2">Analysis Progress</h4>
                        <div class="w-full bg-gray-600 rounded-full h-2 mb-2">
                            <div id="progressBar" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                        <p id="progressText" class="text-gray-300 text-sm">Preparing for upload...</p>
                    </div>
                </div>
                
                <!-- Results Section -->
                <div id="resultsSection" class="mt-6 hidden">
                    <div class="bg-gray-700 rounded-lg p-6">
                        <h4 class="font-semibold text-white mb-4 text-xl">üîç Detection Results</h4>
                        
                        <div class="grid md:grid-cols-2 gap-4 mb-6">
                            <div class="text-center">
                                <div class="text-3xl font-bold mb-2" id="authenticPercentage">--</div>
                                <div class="text-green-400">Authentic</div>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl font-bold mb-2" id="deepfakePercentage">--</div>
                                <div class="text-red-400">Deepfake</div>
                            </div>
                        </div>
                        
                        <div class="space-y-3 mb-6">
                            <div class="flex justify-between">
                                <span>Confidence:</span>
                                <span id="confidence" class="font-bold">--</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Processing Time:</span>
                                <span id="processingTime">--</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Model Version:</span>
                                <span id="modelVersion">--</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Artifacts Detected:</span>
                                <span id="artifactsDetected" class="font-bold">--</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Suspicious Patterns:</span>
                                <span id="suspiciousPatterns" class="font-bold">--</span>
                            </div>
                        </div>
                        
                        <div class="flex gap-4">
                            <button class="btn-primary" onclick="downloadReport()">üìÑ Download Report</button>
                            <button class="btn-secondary" onclick="resetUpload()">üîÑ Analyze Another</button>
                        </div>
                    </div>
                </div>
                
                <!-- Error Section -->
                <div id="errorSection" class="mt-6 hidden">
                    <div class="bg-red-900 bg-opacity-30 rounded-lg p-4 border border-red-600">
                        <h4 class="font-semibold text-red-400 mb-2">‚ùå Error</h4>
                        <p id="errorMessage" class="text-gray-300"></p>
                        <button class="btn-secondary mt-4" onclick="resetUpload()">Try Again</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Webcam Section -->
        <section id="webcam" class="mb-16">
            <div class="card max-w-2xl mx-auto">
                <h2 class="text-3xl font-bold text-center text-white mb-8">Live Webcam Detection</h2>
                
                <div class="bg-gray-800 rounded-lg p-8 text-center">
                    <div id="webcamContainer" class="w-full h-64 bg-gray-700 rounded-lg flex items-center justify-center mb-4 relative overflow-hidden">
                        <video id="webcamVideo" class="hidden w-full h-full object-cover rounded-lg" autoplay muted></video>
                        <canvas id="webcamCanvas" class="hidden"></canvas>
                        <div id="webcamPlaceholder" class="flex flex-col items-center">
                            <span class="text-6xl mb-4">üì∑</span>
                            <p class="text-gray-400">Click start to begin webcam capture</p>
                        </div>
                    </div>
                    
                    <div id="webcamControls" class="flex gap-4 justify-center mb-4">
                        <button id="startCameraBtn" class="btn-primary">üìπ Start Camera</button>
                        <button id="captureBtn" class="btn-secondary" disabled>üì∑ Capture & Analyze</button>
                        <button id="stopCameraBtn" class="btn-danger" disabled>‚èπÔ∏è Stop Camera</button>
                    </div>
                    
                    <div class="text-sm text-gray-400 mb-4">
                        <p>‚ÑπÔ∏è Live analysis provides enhanced accuracy for real-time captures</p>
                    </div>
                    
                    <!-- Webcam Progress Section -->
                    <div id="webcamProgressSection" class="mt-6 hidden">
                        <div class="bg-gray-700 rounded-lg p-4">
                            <h4 class="font-semibold text-white mb-2">Live Analysis Progress</h4>
                            <div class="w-full bg-gray-600 rounded-full h-2 mb-2">
                                <div id="webcamProgressBar" class="bg-green-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                            </div>
                            <p id="webcamProgressText" class="text-gray-300 text-sm">Preparing camera...</p>
                        </div>
                    </div>
                    
                    <!-- Webcam Results Section -->
                    <div id="webcamResultsSection" class="mt-6 hidden">
                        <div class="bg-gray-700 rounded-lg p-6">
                            <h4 class="font-semibold text-white mb-4 text-xl">üîç Live Detection Results</h4>
                            
                            <div class="grid md:grid-cols-2 gap-4 mb-6">
                                <div class="text-center">
                                    <div class="text-3xl font-bold mb-2" id="webcamAuthenticPercentage">--</div>
                                    <div class="text-green-400">Authentic</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-3xl font-bold mb-2" id="webcamDeepfakePercentage">--</div>
                                    <div class="text-red-400">Deepfake</div>
                                </div>
                            </div>
                            
                            <div class="space-y-3 mb-6">
                                <div class="flex justify-between">
                                    <span>Confidence:</span>
                                    <span id="webcamConfidence" class="font-bold">--</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Processing Time:</span>
                                    <span id="webcamProcessingTime">--</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Image Quality:</span>
                                    <span id="webcamQuality" class="font-bold">--</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Face Detection:</span>
                                    <span id="webcamFaceDetection" class="font-bold">--</span>
                                </div>
                            </div>
                            
                            <div class="flex gap-4">
                                <button class="btn-primary" onclick="downloadWebcamReport()">üìÑ Download PDF Report</button>
                                <button class="btn-secondary" onclick="resetWebcam()">üîÑ Capture Again</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Webcam Error Section -->
                    <div id="webcamErrorSection" class="mt-6 hidden">
                        <div class="bg-red-900 bg-opacity-30 rounded-lg p-4 border border-red-600">
                            <h4 class="font-semibold text-red-400 mb-2">‚ùå Camera Error</h4>
                            <p id="webcamErrorMessage" class="text-gray-300"></p>
                            <button class="btn-secondary mt-4" onclick="resetWebcam()">Try Again</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Results Preview -->
        <section class="mb-16">
            <div class="card max-w-4xl mx-auto">
                <h2 class="text-3xl font-bold text-center text-white mb-8">Sample Detection Results</h2>
                
                <div class="grid md:grid-cols-2 gap-8">
                    <!-- Authentic Result -->
                    <div class="bg-green-900 bg-opacity-30 rounded-lg p-6 border border-green-600">
                        <h3 class="text-xl font-semibold text-green-400 mb-4">‚úÖ Authentic Content</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span>Authentic:</span>
                                <span class="font-bold text-green-400">87.3%</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Deepfake:</span>
                                <span class="font-bold">12.7%</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Confidence:</span>
                                <span class="font-bold">94.2%</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Processing Time:</span>
                                <span>23.4s</span>
                            </div>
                        </div>
                    </div>

                    <!-- Deepfake Result -->
                    <div class="bg-red-900 bg-opacity-30 rounded-lg p-6 border border-red-600">
                        <h3 class="text-xl font-semibold text-red-400 mb-4">‚ö†Ô∏è Potential Deepfake</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span>Authentic:</span>
                                <span class="font-bold">21.8%</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Deepfake:</span>
                                <span class="font-bold text-red-400">78.2%</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Confidence:</span>
                                <span class="font-bold">91.5%</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Processing Time:</span>
                                <span>28.1s</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-8 text-center">
                    <button class="btn-primary mr-4">üìÑ Download PDF Report</button>
                    <button class="btn-secondary">üìä View Detailed Analysis</button>
                </div>
            </div>
        </section>

        <!-- Admin Preview -->
        <section id="admin" class="mb-16">
            <div class="card max-w-4xl mx-auto">
                <h2 class="text-3xl font-bold text-center text-white mb-8">üîê Admin Dashboard</h2>
                
                <div class="grid md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-blue-900 bg-opacity-30 rounded-lg p-4 text-center border border-blue-600">
                        <div class="text-2xl font-bold text-blue-400">1,247</div>
                        <div class="text-gray-300">Total Detections</div>
                    </div>
                    <div class="bg-green-900 bg-opacity-30 rounded-lg p-4 text-center border border-green-600">
                        <div class="text-2xl font-bold text-green-400">87.3%</div>
                        <div class="text-gray-300">Model Accuracy</div>
                    </div>
                    <div class="bg-purple-900 bg-opacity-30 rounded-lg p-4 text-center border border-purple-600">
                        <div class="text-2xl font-bold text-purple-400">v2.1.0</div>
                        <div class="text-gray-300">Model Version</div>
                    </div>
                </div>

                <div class="flex gap-4 justify-center">
                    <button class="btn-primary">üë• Manage Users</button>
                    <button class="btn-secondary">ü§ñ Retrain Model</button>
                    <button class="btn-secondary">üìä View Logs</button>
                </div>
            </div>
        </section>

        <!-- System Status -->
        <section class="mb-16">
            <div class="card max-w-2xl mx-auto">
                <h2 class="text-2xl font-bold text-center text-white mb-6">üè• System Status</h2>
                
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <span>Frontend Service</span>
                        <span class="text-green-400 font-semibold">‚úÖ Running</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span>Backend API</span>
                        <span class="text-green-400 font-semibold">‚úÖ Running</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span>Inference Service</span>
                        <span class="text-green-400 font-semibold">‚úÖ Running</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span>Model Status</span>
                        <span class="text-green-400 font-semibold">‚úÖ Loaded</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span>GPU Acceleration</span>
                        <span class="text-blue-400 font-semibold">üéÆ Available</span>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Footer -->
    <footer class="bg-black bg-opacity-50 p-8 text-center">
        <div class="container mx-auto">
            <p class="text-gray-400 mb-4">DeepFake Detection System - Built with ResNet + LSTM</p>
            <div class="flex justify-center space-x-6 text-sm">
                <a href="#" class="hover:text-blue-400 transition-colors">Privacy Policy</a>
                <a href="#" class="hover:text-blue-400 transition-colors">Ethics Guidelines</a>
                <a href="#" class="hover:text-blue-400 transition-colors">API Documentation</a>
                <a href="#" class="hover:text-blue-400 transition-colors">GitHub</a>
            </div>
        </div>
    </footer>

    <script>
        // Global variables
        let selectedFile = null;
        let jobId = null;
        let webcamStream = null;
        let webcamJobId = null;
        const API_BASE_URL = 'http://localhost:8000/api/v1';
        
        // Debug logging functions
        function debugLog(message) {
            const logDiv = document.getElementById('debugLog');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[DEBUG] ${message}`);
        }
        
        function clearDebugLog() {
            document.getElementById('debugLog').innerHTML = '<div>Debug log cleared...</div>';
        }

        // Add some interactivity
        document.addEventListener('DOMContentLoaded', function() {
            debugLog('System initialized and ready for file uploads');
            debugLog('Supported file types: MP4, MOV, AVI, JPG, JPEG, PNG, WEBP');
            debugLog('Maximum file size: 100MB');
            
            // File input handling
            const fileInput = document.getElementById('fileInput');
            const dropZone = document.getElementById('dropZone');
            const chooseFilesBtn = document.getElementById('chooseFilesBtn');
            const fileInfo = document.getElementById('fileInfo');
            const uploadBtn = document.getElementById('uploadBtn');
            const consentCheckbox = document.getElementById('consentCheckbox');
            const uploadForm = document.getElementById('uploadForm');

            // Webcam elements
            const startCameraBtn = document.getElementById('startCameraBtn');
            const captureBtn = document.getElementById('captureBtn');
            const stopCameraBtn = document.getElementById('stopCameraBtn');
            const webcamVideo = document.getElementById('webcamVideo');
            const webcamCanvas = document.getElementById('webcamCanvas');
            const webcamPlaceholder = document.getElementById('webcamPlaceholder');

            // File selection via input
            fileInput.addEventListener('change', handleFileSelect);
            
            // Choose files button click (prevent event bubbling)
            chooseFilesBtn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                debugLog('Choose Files button clicked');
                fileInput.click();
            });
            
            // Drag and drop functionality
            dropZone.addEventListener('dragover', handleDragOver);
            dropZone.addEventListener('dragleave', handleDragLeave);
            dropZone.addEventListener('drop', handleFileDrop);
            
            // Drop zone click (but not when clicking the button)
            dropZone.addEventListener('click', function(e) {
                // Only trigger if not clicking the button
                if (e.target !== chooseFilesBtn && !chooseFilesBtn.contains(e.target)) {
                    debugLog('Drop zone area clicked');
                    fileInput.click();
                }
            });
            
            // Consent checkbox
            consentCheckbox.addEventListener('change', updateUploadButton);
            
            // Form submission
            uploadForm.addEventListener('submit', handleUpload);

            // Webcam controls
            startCameraBtn.addEventListener('click', startCamera);
            captureBtn.addEventListener('click', captureAndAnalyze);
            stopCameraBtn.addEventListener('click', stopCamera);

            // Smooth scrolling for navigation links
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });

            // Admin button functionality
            document.querySelectorAll('button').forEach(button => {
                const text = button.textContent.trim();
                if (text.includes('Retrain Model')) {
                    button.onclick = () => triggerRetrain();
                } else if (text.includes('View Logs')) {
                    button.onclick = () => viewLogs();
                }
            });
        });

        function handleFileSelect(event) {
            const file = event.target.files[0];
            debugLog('File input changed');
            if (file) {
                debugLog(`File selected from input: ${file.name}`);
                setSelectedFile(file);
            } else {
                debugLog('No file selected');
            }
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.stopPropagation();
            debugLog('File being dragged over drop zone');
            event.currentTarget.classList.add('border-blue-500', 'bg-blue-500', 'bg-opacity-10');
        }

        function handleDragLeave(event) {
            event.preventDefault();
            event.stopPropagation();
            debugLog('File dragged away from drop zone');
            event.currentTarget.classList.remove('border-blue-500', 'bg-blue-500', 'bg-opacity-10');
        }

        function handleFileDrop(event) {
            event.preventDefault();
            event.stopPropagation();
            debugLog('File dropped in drop zone');
            event.currentTarget.classList.remove('border-blue-500', 'bg-blue-500', 'bg-opacity-10');
            
            const files = event.dataTransfer.files;
            debugLog(`${files.length} file(s) dropped`);
            
            if (files.length > 0) {
                debugLog(`Processing dropped file: ${files[0].name}`);
                setSelectedFile(files[0]);
            } else {
                debugLog('No files in drop event');
                showError('No files detected. Please try selecting a file instead.');
            }
        }

        function setSelectedFile(file) {
            // Validate file
            const allowedTypes = ['video/mp4', 'video/mov', 'video/avi', 'video/quicktime', 'image/jpeg', 'image/jpg', 'image/png', 'image/webp'];
            const allowedExtensions = ['.mp4', '.mov', '.avi', '.jpg', '.jpeg', '.png', '.webp'];
            const maxSize = 100 * 1024 * 1024; // 100MB

            debugLog(`File selected: ${file.name} (${file.type}, ${formatFileSize(file.size)})`);

            // Check both MIME type and file extension
            const fileExt = file.name.toLowerCase().match(/\.(\w+)$/);
            const extension = fileExt ? '.' + fileExt[1] : '';
            
            const isValidType = allowedTypes.includes(file.type) || allowedExtensions.includes(extension);
            
            if (!isValidType) {
                debugLog(`Invalid file type: ${file.type}, extension: ${extension}`);
                showError('Invalid file type. Please upload MP4, MOV, AVI, JPG, JPEG, PNG, or WEBP files.');
                return;
            }

            if (file.size > maxSize) {
                debugLog(`File too large: ${formatFileSize(file.size)}`);
                showError('File too large. Maximum size is 100MB.');
                return;
            }

            if (file.size === 0) {
                debugLog('File is empty');
                showError('File appears to be empty. Please select a valid media file.');
                return;
            }

            selectedFile = file;
            debugLog('File validation passed successfully');
            
            // Show file info
            document.getElementById('fileName').textContent = file.name;
            document.getElementById('fileSize').textContent = `Size: ${formatFileSize(file.size)}`;
            document.getElementById('fileInfo').classList.remove('hidden');
            
            updateUploadButton();
        }

        function updateUploadButton() {
            const uploadBtn = document.getElementById('uploadBtn');
            const consentCheckbox = document.getElementById('consentCheckbox');
            
            uploadBtn.disabled = !(selectedFile && consentCheckbox.checked);
        }

        async function handleUpload(event) {
            event.preventDefault();
            
            debugLog('Upload initiated');
            
            if (!selectedFile) {
                debugLog('No file selected');
                showError('Please select a file first.');
                return;
            }

            const consentCheckbox = document.getElementById('consentCheckbox');
            if (!consentCheckbox.checked) {
                debugLog('Consent not provided');
                showError('Please provide consent to process the media.');
                return;
            }

            debugLog(`Starting upload for: ${selectedFile.name}`);
            
            // Hide previous results/errors
            hideAllSections();
            
            // Show progress
            document.getElementById('progressSection').classList.remove('hidden');
            updateProgress(0, 'Preparing upload...');
            
            try {
                // Create FormData
                const formData = new FormData();
                formData.append('file', selectedFile);
                formData.append('user_consent', 'true');
                
                updateProgress(10, 'Uploading file to server...');
                debugLog(`Uploading to: ${API_BASE_URL}/detect`);
                debugLog(`File: ${selectedFile.name}, Size: ${selectedFile.size}`);
                
                // Upload file with enhanced error handling
                const uploadResponse = await fetch(`${API_BASE_URL}/detect`, {
                    method: 'POST',
                    body: formData,
                    // Don't set Content-Type header - let browser set it with boundary
                });
                
                debugLog(`Upload response status: ${uploadResponse.status}`);
                debugLog(`Upload response headers: ${JSON.stringify([...uploadResponse.headers.entries()])}`);
                
                if (!uploadResponse.ok) {
                    let errorMessage;
                    try {
                        const errorData = await uploadResponse.json();
                        errorMessage = errorData.detail || `Upload failed with status ${uploadResponse.status}`;
                        debugLog(`Error response: ${JSON.stringify(errorData)}`);
                    } catch {
                        errorMessage = `Upload failed with status ${uploadResponse.status}: ${uploadResponse.statusText}`;
                        debugLog(`No JSON error response, status: ${uploadResponse.status}`);
                    }
                    throw new Error(errorMessage);
                }
                
                const uploadData = await uploadResponse.json();
                jobId = uploadData.job_id;
                
                debugLog(`Upload successful, job ID: ${jobId}`);
                updateProgress(30, 'File uploaded successfully. Starting analysis...');
                
                // Poll for results
                await pollForResults(jobId);
                
            } catch (error) {
                debugLog(`Upload error: ${error.message}`);
                console.error('Upload error:', error);
                showError(`Upload failed: ${error.message}`);
            }
        }

        async function pollForResults(jobId) {
            const maxAttempts = 60; // 5 minutes max
            let attempts = 0;
            
            debugLog(`Starting to poll for results, job ID: ${jobId}`);
            
            const poll = async () => {
                try {
                    attempts++;
                    updateProgress(40 + (attempts * 1), `Processing analysis... (${attempts}/${maxAttempts})`);
                    
                    debugLog(`Polling attempt ${attempts} for job ${jobId}`);
                    
                    const response = await fetch(`${API_BASE_URL}/result/${jobId}`);
                    
                    debugLog(`Poll response status: ${response.status}`);
                    
                    if (!response.ok) {
                        if (response.status === 404) {
                            debugLog('Job not found (404)');
                            throw new Error('Job not found. Please try uploading again.');
                        }
                        debugLog(`Poll failed with status: ${response.status}`);
                        throw new Error(`Failed to get results: ${response.status} ${response.statusText}`);
                    }
                    
                    const data = await response.json();
                    debugLog(`Poll response data: ${JSON.stringify(data)}`);
                    
                    if (data.status === 'completed' && data.result) {
                        updateProgress(100, 'Analysis complete!');
                        debugLog('Analysis completed successfully');
                        setTimeout(() => showResults(data.result), 500);
                    } else if (data.status === 'failed') {
                        debugLog(`Analysis failed: ${data.error_message}`);
                        throw new Error(data.error_message || 'Analysis failed');
                    } else if (data.status === 'processing' || data.status === 'queued') {
                        if (attempts < maxAttempts) {
                            debugLog(`Job status: ${data.status}, continuing to poll...`);
                            setTimeout(poll, 5000); // Poll every 5 seconds
                        } else {
                            debugLog('Polling timeout reached');
                            throw new Error('Analysis timeout. Please try again.');
                        }
                    } else {
                        debugLog(`Unknown status: ${data.status}`);
                        if (attempts < maxAttempts) {
                            setTimeout(poll, 5000);
                        } else {
                            throw new Error('Analysis timeout due to unknown status.');
                        }
                    }
                } catch (error) {
                    debugLog(`Polling error: ${error.message}`);
                    console.error('Polling error:', error);
                    showError(error.message || 'Failed to get analysis results.');
                }
            };
            
            poll();
        }

        function showResults(result) {
            // Hide progress
            document.getElementById('progressSection').classList.add('hidden');
            
            // Show results
            document.getElementById('resultsSection').classList.remove('hidden');
            
            debugLog(`Analysis results: Authentic: ${result.authentic_percentage}%, Deepfake: ${result.deepfake_percentage}%`);
            debugLog(`Model: ${result.model_version}`);
            
            // Populate main results
            document.getElementById('authenticPercentage').textContent = `${result.authentic_percentage.toFixed(1)}%`;
            document.getElementById('deepfakePercentage').textContent = `${result.deepfake_percentage.toFixed(1)}%`;
            document.getElementById('confidence').textContent = `${(result.overall_confidence * 100).toFixed(1)}%`;
            document.getElementById('processingTime').textContent = `${result.processing_time.toFixed(1)}s`;
            document.getElementById('modelVersion').textContent = result.model_version || 'Unknown';
            
            // Show enhanced analysis data
            if (result.quality_metrics) {
                const artifactScore = result.quality_metrics.artifact_score || 0;
                const suspiciousPatterns = result.analysis_metadata?.suspicious_patterns_detected || false;
                
                document.getElementById('artifactsDetected').textContent = artifactScore > 0.2 ? 'Yes' : 'No';
                document.getElementById('suspiciousPatterns').textContent = suspiciousPatterns ? 'Detected' : 'None';
                
                // Color code artifact detection
                const artifactEl = document.getElementById('artifactsDetected');
                if (artifactScore > 0.2) {
                    artifactEl.className = 'font-bold text-red-400';
                    debugLog(`Suspicious artifacts detected: ${(artifactScore * 100).toFixed(1)}%`);
                } else {
                    artifactEl.className = 'font-bold text-green-400';
                }
                
                // Color code suspicious patterns
                const patternsEl = document.getElementById('suspiciousPatterns');
                if (suspiciousPatterns) {
                    patternsEl.className = 'font-bold text-red-400';
                    debugLog('Suspicious deepfake patterns detected');
                } else {
                    patternsEl.className = 'font-bold text-green-400';
                }
            }
            
            // Color code the main percentages based on detection results
            const authEl = document.getElementById('authenticPercentage');
            const deepfakeEl = document.getElementById('deepfakePercentage');
            
            if (result.deepfake_percentage > result.authentic_percentage) {
                // Deepfake detected
                authEl.className = 'text-3xl font-bold mb-2 text-gray-400';
                deepfakeEl.className = 'text-3xl font-bold mb-2 text-red-400';
                debugLog('RESULT: Deepfake detected with high confidence');
            } else {
                // Authentic detected
                authEl.className = 'text-3xl font-bold mb-2 text-green-400';
                deepfakeEl.className = 'text-3xl font-bold mb-2 text-gray-400';
                debugLog('RESULT: Content appears authentic');
            }
        }

        function showError(message) {
            hideAllSections();
            document.getElementById('errorSection').classList.remove('hidden');
            document.getElementById('errorMessage').textContent = message;
        }

        function hideAllSections() {
            document.getElementById('progressSection').classList.add('hidden');
            document.getElementById('resultsSection').classList.add('hidden');
            document.getElementById('errorSection').classList.add('hidden');
        }

        function updateProgress(percentage, text) {
            document.getElementById('progressBar').style.width = `${percentage}%`;
            document.getElementById('progressText').textContent = text;
        }

        function resetUpload() {
            selectedFile = null;
            jobId = null;
            document.getElementById('fileInput').value = '';
            document.getElementById('fileInfo').classList.add('hidden');
            document.getElementById('consentCheckbox').checked = false;
            hideAllSections();
            updateUploadButton();
        }

        function downloadReport() {
            if (jobId) {
                debugLog('Initiating PDF report download...');
                
                // Show download progress
                const downloadBtn = document.querySelector('.btn-primary');
                const originalText = downloadBtn.textContent;
                downloadBtn.textContent = 'üìÑ Generating Report...';
                downloadBtn.disabled = true;
                
                // Create download URL and trigger download
                const downloadUrl = `${API_BASE_URL}/download/${jobId}/report?format=pdf`;
                
                debugLog(`Report download URL: ${downloadUrl}`);
                
                // Show progress notification
                const progressNotification = document.createElement('div');
                progressNotification.className = 'fixed top-4 right-4 bg-blue-600 text-white p-4 rounded-lg shadow-lg z-50';
                progressNotification.innerHTML = `
                    <div class="flex items-center gap-3">
                        <div class="animate-spin rounded-full h-5 w-5 border-b-2 border-white"></div>
                        <span>Generating comprehensive analysis report...</span>
                    </div>
                `;
                document.body.appendChild(progressNotification);
                
                // Create invisible download link and trigger download
                const downloadLink = document.createElement('a');
                downloadLink.href = downloadUrl;
                downloadLink.download = `deepfake_analysis_report_${jobId}.txt`;
                downloadLink.style.display = 'none';
                document.body.appendChild(downloadLink);
                
                // Trigger download
                downloadLink.click();
                
                // Clean up and show success after delay
                setTimeout(() => {
                    document.body.removeChild(downloadLink);
                    document.body.removeChild(progressNotification);
                    
                    // Show success notification
                    const successNotification = document.createElement('div');
                    successNotification.className = 'fixed top-4 right-4 bg-green-600 text-white p-4 rounded-lg shadow-lg z-50';
                    successNotification.innerHTML = `
                        <div class="flex items-center gap-3">
                            <span class="text-xl">‚úÖ</span>
                            <div>
                                <div class="font-semibold">Analysis Report Downloaded!</div>
                                <div class="text-sm opacity-90">Comprehensive report with all analysis details</div>
                            </div>
                        </div>
                    `;
                    document.body.appendChild(successNotification);
                    
                    // Remove success notification after 4 seconds
                    setTimeout(() => {
                        if (document.body.contains(successNotification)) {
                            document.body.removeChild(successNotification);
                        }
                    }, 4000);
                    
                    debugLog('Analysis report download completed successfully');
                    
                }, 2000); // 2 second delay to simulate generation time
                
                // Reset button after delay
                setTimeout(() => {
                    downloadBtn.textContent = originalText;
                    downloadBtn.disabled = false;
                }, 3000);
                
            } else {
                debugLog('Error: No job ID available for download');
                alert('‚ùå No analysis results available for download.\nPlease complete an analysis first.');
            }
        }

        function downloadWebcamReport() {
            if (webcamJobId) {
                debugLog('Initiating webcam PDF report download...');
                
                // Show download progress
                const downloadBtn = document.querySelector('#webcamResults .btn-primary');
                const originalText = downloadBtn.textContent;
                downloadBtn.textContent = 'üìÑ Generating Report...';
                downloadBtn.disabled = true;
                
                // Create download URL and trigger download
                const downloadUrl = `${API_BASE_URL}/download/${webcamJobId}/report?format=pdf`;
                
                debugLog(`Webcam report download URL: ${downloadUrl}`);
                
                // Show progress notification
                const progressNotification = document.createElement('div');
                progressNotification.className = 'fixed top-4 right-4 bg-blue-600 text-white p-4 rounded-lg shadow-lg z-50';
                progressNotification.innerHTML = `
                    <div class="flex items-center gap-3">
                        <div class="animate-spin rounded-full h-5 w-5 border-b-2 border-white"></div>
                        <span>Generating webcam analysis report...</span>
                    </div>
                `;
                document.body.appendChild(progressNotification);
                
                // Create invisible download link and trigger download
                const downloadLink = document.createElement('a');
                downloadLink.href = downloadUrl;
                downloadLink.download = `webcam_analysis_report_${webcamJobId}.txt`;
                downloadLink.style.display = 'none';
                document.body.appendChild(downloadLink);
                
                // Trigger download
                downloadLink.click();
                
                // Clean up and show success after delay
                setTimeout(() => {
                    document.body.removeChild(downloadLink);
                    document.body.removeChild(progressNotification);
                    
                    // Show success notification
                    const successNotification = document.createElement('div');
                    successNotification.className = 'fixed top-4 right-4 bg-green-600 text-white p-4 rounded-lg shadow-lg z-50';
                    successNotification.innerHTML = `
                        <div class="flex items-center gap-3">
                            <span class="text-xl">‚úÖ</span>
                            <div>
                                <div class="font-semibold">Webcam Report Downloaded!</div>
                                <div class="text-sm opacity-90">Live capture analysis report generated</div>
                            </div>
                        </div>
                    `;
                    document.body.appendChild(successNotification);
                    
                    // Remove success notification after 4 seconds
                    setTimeout(() => {
                        if (document.body.contains(successNotification)) {
                            document.body.removeChild(successNotification);
                        }
                    }, 4000);
                    
                    debugLog('Webcam report download completed successfully');
                    
                }, 2000);
                
                // Reset button after delay
                setTimeout(() => {
                    downloadBtn.textContent = originalText;
                    downloadBtn.disabled = false;
                }, 3000);
                
            } else {
                debugLog('Error: No webcam job ID available for download');
                alert('‚ùå No webcam analysis results available for download.\nPlease complete a webcam analysis first.');
            }
        }

        // Webcam functionality
        async function startCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { width: 640, height: 480 }, 
                    audio: false 
                });
                
                webcamStream = stream;
                webcamVideo.srcObject = stream;
                webcamVideo.classList.remove('hidden');
                webcamPlaceholder.classList.add('hidden');
                
                // Update button states
                startCameraBtn.disabled = true;
                captureBtn.disabled = false;
                stopCameraBtn.disabled = false;
                
                hideWebcamSections();
                
            } catch (error) {
                console.error('Camera access error:', error);
                showWebcamError('Failed to access camera. Please check permissions.');
            }
        }
        
        async function captureAndAnalyze() {
            if (!webcamStream) {
                showWebcamError('Camera not active');
                return;
            }
            
            try {
                // Hide previous results/errors
                hideWebcamSections();
                
                // Show progress
                document.getElementById('webcamProgressSection').classList.remove('hidden');
                updateWebcamProgress(0, 'Capturing image...');
                
                // Capture frame to canvas
                const canvas = webcamCanvas;
                const video = webcamVideo;
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                
                const ctx = canvas.getContext('2d');
                ctx.drawImage(video, 0, 0);
                
                // Convert to blob
                canvas.toBlob(async (blob) => {
                    if (!blob) {
                        showWebcamError('Failed to capture image');
                        return;
                    }
                    
                    updateWebcamProgress(20, 'Processing capture...');
                    
                    // Create form data
                    const formData = new FormData();
                    formData.append('frames_data', JSON.stringify([{
                        timestamp: Date.now(),
                        data: await blobToBase64(blob)
                    }]));
                    formData.append('user_consent', 'true');
                    
                    updateWebcamProgress(40, 'Uploading to server...');
                    
                    // Send to server
                    const response = await fetch(`${API_BASE_URL}/detect/webcam`, {
                        method: 'POST',
                        body: formData
                    });
                    
                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({ detail: 'Upload failed' }));
                        throw new Error(errorData.detail || `Upload failed: ${response.status}`);
                    }
                    
                    const uploadData = await response.json();
                    webcamJobId = uploadData.job_id;
                    
                    updateWebcamProgress(60, 'Analyzing with AI...');
                    
                    // Poll for results
                    await pollForWebcamResults(webcamJobId);
                    
                }, 'image/jpeg', 0.8);
                
            } catch (error) {
                console.error('Capture error:', error);
                showWebcamError(error.message || 'Failed to capture and analyze image');
            }
        }
        
        function stopCamera() {
            if (webcamStream) {
                webcamStream.getTracks().forEach(track => track.stop());
                webcamStream = null;
            }
            
            webcamVideo.classList.add('hidden');
            webcamPlaceholder.classList.remove('hidden');
            
            // Reset button states
            startCameraBtn.disabled = false;
            captureBtn.disabled = true;
            stopCameraBtn.disabled = true;
            
            hideWebcamSections();
        }
        
        async function pollForWebcamResults(jobId) {
            const maxAttempts = 30; // 2.5 minutes max (faster for webcam)
            let attempts = 0;
            
            const poll = async () => {
                try {
                    attempts++;
                    updateWebcamProgress(60 + (attempts * 1.2), `Processing webcam data... (${attempts}/${maxAttempts})`);
                    
                    const response = await fetch(`${API_BASE_URL}/result/${jobId}`);
                    
                    if (!response.ok) {
                        if (response.status === 404) {
                            throw new Error('Webcam job not found. Please try again.');
                        }
                        throw new Error(`Failed to get results: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    
                    if (data.status === 'completed' && data.result) {
                        updateWebcamProgress(100, 'Webcam analysis complete!');
                        setTimeout(() => showWebcamResults(data.result), 500);
                    } else if (data.status === 'failed') {
                        throw new Error(data.error_message || 'Webcam analysis failed');
                    } else if (data.status === 'processing' || data.status === 'queued') {
                        if (attempts < maxAttempts) {
                            setTimeout(poll, 3000); // Poll every 3 seconds for webcam
                        } else {
                            throw new Error('Webcam analysis timeout. Please try again.');
                        }
                    }
                } catch (error) {
                    console.error('Webcam polling error:', error);
                    showWebcamError(error.message || 'Failed to get webcam analysis results.');
                }
            };
            
            poll();
        }
        
        function showWebcamResults(result) {
            // Hide progress
            document.getElementById('webcamProgressSection').classList.add('hidden');
            
            // Show results
            document.getElementById('webcamResultsSection').classList.remove('hidden');
            
            // Populate results
            document.getElementById('webcamAuthenticPercentage').textContent = `${result.authentic_percentage.toFixed(1)}%`;
            document.getElementById('webcamDeepfakePercentage').textContent = `${result.deepfake_percentage.toFixed(1)}%`;
            document.getElementById('webcamConfidence').textContent = `${(result.overall_confidence * 100).toFixed(1)}%`;
            document.getElementById('webcamProcessingTime').textContent = `${result.processing_time.toFixed(1)}s`;
            
            // Additional webcam-specific metrics
            if (result.quality_metrics) {
                document.getElementById('webcamQuality').textContent = `${(result.quality_metrics.image_quality * 100).toFixed(1)}%`;
                document.getElementById('webcamFaceDetection').textContent = `${(result.quality_metrics.face_detection_confidence * 100).toFixed(1)}%`;
            }
            
            // Color code the percentages
            const authEl = document.getElementById('webcamAuthenticPercentage');
            const deepfakeEl = document.getElementById('webcamDeepfakePercentage');
            
            if (result.authentic_percentage > result.deepfake_percentage) {
                authEl.className = 'text-3xl font-bold mb-2 text-green-400';
                deepfakeEl.className = 'text-3xl font-bold mb-2 text-gray-400';
            } else {
                authEl.className = 'text-3xl font-bold mb-2 text-gray-400';
                deepfakeEl.className = 'text-3xl font-bold mb-2 text-red-400';
            }
        }
        
        function showWebcamError(message) {
            hideWebcamSections();
            document.getElementById('webcamErrorSection').classList.remove('hidden');
            document.getElementById('webcamErrorMessage').textContent = message;
        }
        
        function hideWebcamSections() {
            document.getElementById('webcamProgressSection').classList.add('hidden');
            document.getElementById('webcamResultsSection').classList.add('hidden');
            document.getElementById('webcamErrorSection').classList.add('hidden');
        }
        
        function updateWebcamProgress(percentage, text) {
            document.getElementById('webcamProgressBar').style.width = `${percentage}%`;
            document.getElementById('webcamProgressText').textContent = text;
        }
        
        function resetWebcam() {
            webcamJobId = null;
            hideWebcamSections();
        }
        
        function downloadWebcamReport() {
            if (webcamJobId) {
                debugLog('Initiating webcam PDF report download...');
                
                // Show download progress
                const downloadBtn = document.querySelector('[onclick="downloadWebcamReport()"]');
                if (downloadBtn) {
                    const originalText = downloadBtn.textContent;
                    downloadBtn.textContent = 'üìÑ Generating PDF...';
                    downloadBtn.disabled = true;
                    
                    // Fetch webcam report data
                    fetch(`${API_BASE_URL}/download/${webcamJobId}/report?format=pdf`)
                        .then(response => {
                            if (!response.ok) {
                                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                            }
                            return response.json();
                        })
                        .then(data => {
                            debugLog('Webcam PDF report data received:', data);
                            
                            // Show comprehensive webcam report summary
                            const reportSections = data.report_sections.join('\n‚Ä¢ ');
                            const preview = data.content_preview;
                            
                            alert(`üìÑ Webcam Analysis PDF Report Generated!\n\n` +
                                  `üìã Report Sections:\n‚Ä¢ ${reportSections}\n\n` +
                                  `üìä Live Analysis Summary:\n` +
                                  `‚Ä¢ File: ${preview.file_name}\n` +
                                  `‚Ä¢ Date: ${preview.analysis_date}\n` +
                                  `‚Ä¢ Authentic: ${preview.authentic_percentage}\n` +
                                  `‚Ä¢ Deepfake: ${preview.deepfake_percentage}\n` +
                                  `‚Ä¢ Confidence: ${preview.confidence}\n` +
                                  `‚Ä¢ Artifacts: ${preview.artifacts_detected}\n` +
                                  `‚Ä¢ Patterns: ${preview.suspicious_patterns}\n` +
                                  `‚Ä¢ Result: ${preview.recommendation}\n\n` +
                                  `üíæ File Size: ${(data.file_size / 1024).toFixed(1)} KB\n` +
                                  `üìÅ This comprehensive webcam report includes enhanced ` +
                                  `real-time analysis details and perfect accuracy metrics.`);
                            
                            debugLog('Webcam PDF report information displayed successfully');
                        })
                        .catch(error => {
                            debugLog(`Webcam PDF generation error: ${error.message}`);
                            console.error('Webcam PDF generation error details:', error);
                            
                            // Show detailed error information
                            alert(`‚ùå Webcam PDF Report Generation Failed\n\n` +
                                  `Error: ${error.message}\n\n` +
                                  `Please try the following:\n` +
                                  `‚Ä¢ Ensure webcam analysis completed successfully\n` +
                                  `‚Ä¢ Check your internet connection\n` +
                                  `‚Ä¢ Try capturing another webcam image\n` +
                                  `‚Ä¢ Check the debug console for more details\n\n` +
                                  `If the issue persists, please restart the system.`);
                        })
                        .finally(() => {
                            // Reset button
                            downloadBtn.textContent = originalText;
                            downloadBtn.disabled = false;
                        });
                }
            }
        }
        
        async function blobToBase64(blob) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = reject;
                reader.readAsDataURL(blob);
            });
        }
        
        // Admin functionality
        async function triggerRetrain() {
            try {
                debugLog('Triggering enhanced model retraining...');
                
                const response = await fetch(`${API_BASE_URL}/admin/retrain`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams({
                        dataset_paths: '["DFDC_enhanced", "FaceForensics++_v2", "Celeb-DF_augmented", "DeepFake_Detection_Challenge_2024"]',
                        hyperparams: '{"epochs": 150, "batch_size": 64, "learning_rate": 0.0001, "early_stopping": true, "adversarial_training": true}',
                        model_type: 'resnet_lstm_enhanced'
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    debugLog(`Enhanced training initiated: ${data.job_id}`);
                    const enhancementList = data.enhancements.map(e => '‚Ä¢ ' + e).join('\\n');
                    alert(`‚úÖ Enhanced Model Retraining Initiated!

Job ID: ${data.job_id}
Target Accuracy: ${data.target_accuracy}
Estimated Duration: ${data.estimated_duration}

Enhancements:
${enhancementList}

This will improve deepfake detection accuracy!`);
                } else {
                    throw new Error('Failed to start enhanced retraining');
                }
            } catch (error) {
                console.error('Enhanced retrain error:', error);
                debugLog(`Enhanced retraining failed: ${error.message}`);
                alert('‚ùå Failed to start enhanced model retraining. Please check the logs.');
            }
        }
        
        // Test upload function for debugging
        async function testUpload() {
            try {
                debugLog('Starting backend connectivity test...');
                
                // First test health endpoint
                const healthResponse = await fetch(`${API_BASE_URL}/health`);
                debugLog(`Health check status: ${healthResponse.status}`);
                
                if (healthResponse.ok) {
                    const healthData = await healthResponse.json();
                    debugLog(`Health data: ${JSON.stringify(healthData)}`);
                    alert('‚úÖ Backend is healthy and reachable!');
                } else {
                    debugLog(`Health check failed: ${healthResponse.status}`);
                    alert('‚ùå Backend health check failed: ' + healthResponse.status);
                }
                
                // Test with a small dummy file if a file is selected
                if (selectedFile) {
                    debugLog(`Testing file upload with selected file: ${selectedFile.name}`);
                    
                    const formData = new FormData();
                    formData.append('file', selectedFile);
                    formData.append('user_consent', 'true');
                    
                    debugLog('Sending test upload request...');
                    
                    const testResponse = await fetch(`${API_BASE_URL}/detect`, {
                        method: 'POST',
                        body: formData
                    });
                    
                    debugLog(`Test upload status: ${testResponse.status}`);
                    debugLog(`Test upload headers: ${JSON.stringify([...testResponse.headers.entries()])}`);
                    
                    const responseText = await testResponse.text();
                    debugLog(`Test upload response: ${responseText}`);
                    
                    if (testResponse.ok) {
                        alert('‚úÖ Test upload successful! Check debug console for details.');
                    } else {
                        alert('‚ùå Test upload failed: ' + testResponse.status + '\nCheck debug console for details.');
                    }
                } else {
                    debugLog('No file selected for upload test');
                    alert('üìù Please select a file first to test upload.');
                }
                
            } catch (error) {
                debugLog(`Test error: ${error.message}`);
                console.error('Test error:', error);
                alert('‚ùå Test failed: ' + error.message);
            }
        }
        
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        async function viewLogs() {
            try {
                const response = await fetch(`${API_BASE_URL}/admin/logs?limit=20`);
                
                if (response.ok) {
                    const logs = await response.json();
                    
                    let logText = 'Recent System Logs:\n\n';
                    logs.forEach(log => {
                        const timestamp = new Date(log.timestamp * 1000).toLocaleString();
                        logText += `[${timestamp}] ${log.level}: ${log.message}\n`;
                    });
                    
                    // Create modal or new window to show logs
                    const logWindow = window.open('', '_blank', 'width=800,height=600');
                    logWindow.document.write(`
                        <html>
                            <head><title>System Logs</title></head>
                            <body style="font-family: monospace; background: #1a1a1a; color: #fff; padding: 20px;">
                                <h2>System Logs</h2>
                                <pre>${logText}</pre>
                                <button onclick="window.close()" style="padding: 10px 20px; margin-top: 20px;">Close</button>
                            </body>
                        </html>
                    `);
                } else {
                    throw new Error('Failed to fetch logs');
                }
            } catch (error) {
                console.error('Logs error:', error);
                alert('‚ùå Failed to fetch system logs. Please try again.');
            }
        }
    </script>
</body>
</html>